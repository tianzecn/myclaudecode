{
  "url": "https://shipany.ai/zh/docs/payment/stripe",
  "title": "Stripe",
  "content": "ShipAny 集成了 Stripe 作为支付服务供应商，只需简单配置即可接入使用。\n\n按照以下步骤为你的项目接入 Stripe 支付。\n\n参考 Stripe 商家入驻指南 开通 Stripe 商户。\n\n你可以以个人身份或企业身份开通 Stripe 商户，绑定你的提现账户，设置商户基本信息。\n\n在 Stripe 管理后台进入你的商户页面，依次选择 Developers -> API keys -> Standard keys -> Create secret key 创建 API 密钥。\n\n复制得到 Publishable key 和 Secret key。\n\n注意：Secret key 仅在创建时可以复制，为敏感信息，谨防泄露。\n\n你可以在 Stripe 控制台左上角切换商户的地方，依次点击 Switch to sanbox -> Test mode 进入测试环境，创建测试用的 API 密钥。\n\n在项目管理后台，进入 Settings -> Payment -> Stripe 面板，在 Stripe Publishable Key 和 Stripe Secret Key 字段分别填入上一步设置的 Publishable key 和 Secret key。\n\nStripe Signing Secret 是验证支付通知的签名密钥，可以先留空，等在后续步骤配置了支付通知后再填入。\n\n注意：本地开发时，你可以填入上一步设置的测试 API 密钥，等部署上线时，再填入正式的 API 密钥。\n\n访问项目的 /pricing 页面，查看默认的价格表，选择一个价格方案，点击下单按钮。\n\n如果能正常跳转到 Stripe 支付页面，说明支付配置成功。\n\n如果上一步填入的是测试 API 密钥，可以复制一个 Stripe 测试卡号 进行支付验证。\n\n默认的价格表配置在 src/config/locale/messages/{locale}/pages/pricing.json 文件中，支持多语言，每个 locale 对应一个独立的价格表配置。\n\npricing.groups 字段定义了价格方案分组，默认值如下\n\npricing.items 字段定义了价格方案列表，默认的其中一个价格方案数据结构如下：\n\n请根据你的项目需求，参考默认的价格表配置，修改对应的字段内容，设计价格表。\n\n注意：如果你的项目支持多语言，请修改每个 locale 对应的价格表配置。\n\n选择价格方案后，请求下单的接口是 /api/payment/checkout，请求参数示例：\n\n注意：修改完价格表配置后，访问 /pricing 页面查看新的价格表。选择一个价格方案下单，支付成功后，在 /settings/payments 页面查看支付记录，检查支付金额、币种、付费周期，是否与配置的价格方案一致。 在 /settings/credits 页面查看积分发放记录，检查积分数量、过期时间（支付时间 + 有效天数），是否与配置的价格方案一致。\n\n用户在价格表页面选择价格方案下单成功后，会跳转到 Stripe 支付页面，支付成功后，会跳转到项目的回调接口：/api/payment/callback。\n\n在回调接口中，会根据订单号更新订单状态，再跳转到配置的 callbackUrl。\n\n这个配置的 callbackUrl 是在下单接口：/api/payment/checkout 中指定的：\n\n按照默认配置，如果是一次性支付，最终会跳转到 /settings/payments 页面；如果是订阅支付，最终会跳转到 /settings/billing 页面。\n\n你可以根据项目需求，自行修改用户支付完成后的跳转地址。\n\n注意：支付回调是同步跳转的，如果用户在 Stripe 支付页面确认支付，在页面跳转前关闭了浏览器，未能正常跳转到项目回调接口，订单状态无法更新，用户在个人中心无法看到已支付的订单。此类情况叫做：丢单。\n\n为了避免支付回调的 丢单 情况，建议项目上线运营时，在 Stripe 后台配置支付通知。\n\n在 Stripe 商户后台，进入 Developers -> Webhooks 页面，点击 Add destination 按钮，添加支付通知地址。\n\nEvents from 选择 Your account\n\nAPI version 选择 2025-10-29.clover，这是目前调试过的最新版本。\n\nEvents 通过关键词搜索过滤，勾选以下几项：\n\nDestination type 选择 Webhook endpoint\n\nDestination name 输入配置名称，给自己看的，随便填。\n\nEndpoint URL 输入接收通知的地址。必须是可以公网访问的 https 地址。格式为：\n\n把 {your-domain.com} 替换为你的项目域名，可以是根域名，也可以是子域名。\n\n填写完配置后，点击 Create destination 按钮，添加支付通知地址。\n\n创建完支付通知地址后，会自动跳转到支付通知地址的详情页面，点击 Signing secret 下方的复制图标，复制 whsec_ 开头的支付通知的签名密钥。\n\n在项目管理后台，进入 Settings -> Payment -> Stripe 面板，在 Stripe Signing Secret 字段填入上一步复制的支付通知签名密钥。\n\n在上一步配置支付通知时，填写的 Endpoint URL 必须是一个可以公网访问的 https 地址。\n\n项目部署上线前，需要先在本地调试，接收支付通知内容，进行必要的修改和验证。\n\n通过 内网穿透，可以把一个公网地址映射到本地开发机，下面的步骤主要演示使用 ngrok 实现 内网穿透。\n\n访问 ngrok 官网，注册账号，登录管理后台。\n\n在管理后台的 Setup & Instalation 页面，选择你的操作系统类型，按照指示步骤安装 ngrok 命令行工具。\n\n执行以下命令，在指定端口启动项目的开发服务器。\n\n回到 配置支付通知 步骤，复制 ngrok 的代理地址，填入 Endpoint URL。\n\n注意：每次执行 ngrok http {port} 命令，都会生成一个新的代理地址，需要在 Stripe 后台重新配置 Endpoint URL。请确保仅在开发调试时配置，不要在线上环境使用 ngrok 的代理地址。\n\n在按照以上步骤配置支付通知后，在价格表页面选择一个价格方案下单，就可以在本地接收 Stripe 的支付通知了。\n\n默认的支付通知处理逻辑在 src/app/api/payment/notify/[provider]/route.ts 文件中。你可以根据项目需求，自行修改相应的逻辑。\n\n你可以根据项目需求，根据以下列举的例子，自定义支付选项。\n\n设计价格表 时，在价格方案中使用 currency 字段指定下单的币种。比如 原价 199 美元，标价 99 美元，对应的价格方案配置是：\n\n如果要在价格表页面，允许用户选择不同的币种下单，可以参考以下配置：\n\n配置之后，可以看到价格方案多了一个切换币种的选项。价格方案配置中，外层的 currency 是默认币种，currencies 里面的 currency 是可切换的币种。\n\n注意：currency 字段不区分大小写，amount 单位是：分。\n\n按照以下步骤，在你的项目启用 微信 / 支付宝 支付。\n\n在 Stripe 商户后台，进入 Settings -> Payments -> Payment methods -> Default，申请开通 WeChat Pay 和 Alipay。需要提交审核，等审批通过后才能启用。\n\n如果要支持 微信 / 支付宝 支付，在价格方案配置中，currency 字段必须是 cny。\n\n默认美元下单，允许切换人民币支付，配置参考：\n\n在修改完价格方案配置后，需要在管理后台，调整 Stripe Payment Methods 的配置。\n\n勾选你希望用户进入 Stripe 支付页面看到的支付选项。\n\n比如，只允许用户使用微信支付，就勾选 Wechat Pay，取消勾选 Card 和 Alipay\n\n注意：此处勾选的支付方式，必须在 Stripe 商户后台是 Enabled 状态，否则下单会报错。",
  "headings": [
    {
      "level": "h1",
      "text": "Stripe",
      "id": ""
    },
    {
      "level": "h2",
      "text": "接入 Stripe 支付",
      "id": "接入-stripe-支付"
    },
    {
      "level": "h2",
      "text": "设计价格表",
      "id": "设计价格表"
    },
    {
      "level": "h2",
      "text": "配置支付回调",
      "id": "配置支付回调"
    },
    {
      "level": "h2",
      "text": "配置支付通知",
      "id": "配置支付通知"
    },
    {
      "level": "h2",
      "text": "本地调试支付通知",
      "id": "本地调试支付通知"
    },
    {
      "level": "h2",
      "text": "自定义支付选项",
      "id": "自定义支付选项"
    },
    {
      "level": "h3",
      "text": "多币种支付",
      "id": "多币种支付"
    },
    {
      "level": "h3",
      "text": "微信 / 支付宝 支付",
      "id": "微信--支付宝-支付"
    }
  ],
  "code_samples": [
    {
      "code": "{\n  \"pricing\": {\n    \"groups\": [\n      {\n        \"name\": \"one-time\",\n        \"title\": \"Pay as you go\"\n      },\n      {\n        \"name\": \"monthly\",\n        \"title\": \"Monthly\",\n        \"is_featured\": true,\n        \"label\": \"save 15%\"\n      },\n      {\n        \"name\": \"yearly\",\n        \"title\": \"Annually\"\n      }\n    ]\n  }\n}",
      "language": "json"
    },
    {
      "code": "{\n  \"pricing\": {\n    \"items\": [\n      {\n        \"title\": \"Starter\",\n        \"description\": \"Get started with your first SaaS startup.\",\n        \"features_title\": \"Includes\",\n        \"features\": [\n          \"100 credits, valid for 1 month\",\n          \"NextJS boilerplate\",\n          \"SEO-friendly structure\",\n          \"Payment with Stripe\",\n          \"Data storage with Supabase\",\n          \"Google Oauth & One-Tap Login\",\n          \"i18n support\"\n        ],\n        \"interval\": \"one-time\",\n        \"amount\": 9900,\n        \"currency\": \"USD\",\n        \"price\": \"$99\",\n        \"original_price\": \"$199\",\n        \"unit\": \"\",\n        \"is_featured\": false,\n        \"tip\": \"Pay once. Build unlimited projects!\",\n        \"button\": {\n          \"title\": \"Get ShipAny\",\n          \"url\": \"/#pricing\",\n          \"icon\": \"RiFlashlightFill\"\n        },\n        \"product_id\": \"starter\",\n        \"product_name\": \"ShipAny Boilerplate Starter\",\n        \"credits\": 100,\n        \"valid_days\": 30,\n        \"group\": \"one-time\"\n      }\n    ]\n  }\n}",
      "language": "json"
    },
    {
      "code": "{\n  \"product_id\": \"starter\",\n  \"currency\": \"USD\",\n  \"locale\": \"en\",\n  \"payment_provider\": \"stripe\",\n  \"metadata\": {}\n}",
      "language": "json"
    },
    {
      "code": "const callbackUrl =\n  paymentType === PaymentType.SUBSCRIPTION\n    ? `${callbackBaseUrl}/settings/billing`\n    : `${callbackBaseUrl}/settings/payments`;",
      "language": "javascript"
    },
    {
      "code": "# 下单完成\ncheckout.session.completed\n# 支付成功\ninvoice.payment_succeeded\n# 支付失败\ninvoice.payment_failed\n# 订阅更新\ncustomer.subscription.updated\n# 订阅取消\ncustomer.subscription.deleted",
      "language": "markdown"
    },
    {
      "code": "https://{your-domain.com}/api/payment/notify/stripe",
      "language": "yaml"
    },
    {
      "code": "brew install ngrok",
      "language": "unknown"
    },
    {
      "code": "ngrok config add-authtoken {your-authtoken}",
      "language": "unknown"
    },
    {
      "code": "pnpm dev --port 8080",
      "language": "unknown"
    },
    {
      "code": "ngrok http 8080",
      "language": "unknown"
    },
    {
      "code": "https://9d897275dabf.ngrok-free.app/api/payment/notify/stripe",
      "language": "yaml"
    },
    {
      "code": "{\n  \"amount\": 9900,\n  \"currency\": \"USD\",\n  \"price\": \"$99\",\n  \"original_price\": \"$199\"\n}",
      "language": "json"
    },
    {
      "code": "{\n  \"amount\": 9900,\n  \"currency\": \"usd\",\n  \"price\": \"$99\",\n  \"original_price\": \"$199\",\n  \"currencies\": [\n    {\n      \"currency\": \"cny\",\n      \"amount\": 69900,\n      \"price\": \"¥699\",\n      \"original_price\": \"¥1399\"\n    }\n  ]\n}",
      "language": "json"
    },
    {
      "code": "{\n  \"amount\": 69900,\n  \"currency\": \"cny\",\n  \"price\": \"¥699\",\n  \"original_price\": \"¥1399\"\n}",
      "language": "json"
    },
    {
      "code": "{\n  \"amount\": 9900,\n  \"currency\": \"usd\",\n  \"price\": \"$99\",\n  \"original_price\": \"$199\",\n  \"currencies\": [\n    {\n      \"currency\": \"cny\",\n      \"amount\": 69900,\n      \"price\": \"¥699\",\n      \"original_price\": \"¥1399\"\n    }\n  ]\n}",
      "language": "json"
    }
  ],
  "patterns": [],
  "links": [
    "https://shipany.ai/zh/docs/quick-start",
    "https://shipany.ai/zh/docs/config",
    "https://shipany.ai/zh/docs/page-builder",
    "https://shipany.ai/zh/docs/vibe-coding",
    "https://shipany.ai/zh/docs/database",
    "https://shipany.ai/zh/docs/payment/stripe",
    "https://shipany.ai/zh/docs/payment/creem",
    "https://shipany.ai/zh/docs/email",
    "https://shipany.ai/zh/docs/analytics",
    "https://shipany.ai/zh/docs/ads",
    "https://shipany.ai/zh/docs/customer-service",
    "https://shipany.ai/zh/docs/auth/github"
  ]
}