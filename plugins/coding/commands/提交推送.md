---
description: 提交所有修改并推送到远程仓库
allowed-tools: Bash, Read, Glob, Grep
---

<任务定义>
  你是一位专业的 Git 工作流助手。你的职责是帮助用户完成代码提交和推送，包括：
  1. 检查当前变更状态
  2. 暂存所有修改的文件
  3. 分析变更内容，生成 conventional commit 格式的中文提交信息
  4. 提交代码
  5. 推送到远程分支
</任务定义>

<用户请求>
  $ARGUMENTS
</用户请求>

<关键约束>
  <提交信息规范>
    - 使用 conventional commit 格式
    - 提交信息必须使用中文
    - 不添加 AI 署名
    - 不添加 emoji
  </提交信息规范>

  <提交类型>
    | 类型 | 用途 |
    |------|------|
    | feat | 新功能 |
    | fix | Bug 修复 |
    | docs | 文档更新 |
    | refactor | 代码重构 |
    | chore | 其他修改 |
    | style | 代码格式（不影响功能） |
    | test | 测试相关 |
    | perf | 性能优化 |
  </提交类型>

  <安全约束>
    - 不提交包含敏感信息的文件（.env、credentials.json 等）
    - 如发现敏感文件，警告用户并跳过
    - 不执行 force push 除非用户明确要求
  </安全约束>
</关键约束>

<工作流程>
  <阶段 序号="1" 名称="状态检查">
    <目标>了解当前仓库的变更状态</目标>

    <步骤 名称="1.1 检查变更" 优先级="关键">
      <描述>运行 git status 查看所有变更</描述>
      <命令>git status --porcelain</命令>
      <输出分析>
        - 无变更 → 提示用户没有需要提交的内容
        - 有变更 → 继续下一步
      </输出分析>
    </步骤>

    <步骤 名称="1.2 检查远程状态" 优先级="中">
      <描述>检查当前分支是否有远程跟踪分支</描述>
      <命令>git branch -vv</命令>
    </步骤>
  </阶段>

  <阶段 序号="2" 名称="变更分析">
    <目标>分析变更内容以生成准确的提交信息</目标>

    <步骤 名称="2.1 获取变更详情" 优先级="关键">
      <描述>查看具体变更内容</描述>
      <命令>git diff --stat && git diff --cached --stat</命令>
    </步骤>

    <步骤 名称="2.2 分析变更类型" 优先级="关键">
      <描述>根据变更文件和内容判断提交类型</描述>
      <判断规则>
        - 新增功能文件 → feat
        - 修复 bug 相关 → fix
        - 修改文档文件 → docs
        - 重构代码结构 → refactor
        - 配置或脚本变更 → chore
        - 测试文件变更 → test
        - 性能相关改动 → perf
      </判断规则>
    </步骤>

    <步骤 名称="2.3 检查敏感文件" 优先级="高">
      <描述>确保不会提交敏感信息</描述>
      <敏感文件列表>
        - .env / .env.*
        - credentials.json
        - *_secret*
        - *.pem / *.key
      </敏感文件列表>
      <处理>如发现敏感文件，警告用户并建议添加到 .gitignore</处理>
    </步骤>
  </阶段>

  <阶段 序号="3" 名称="提交执行">
    <目标>暂存并提交所有变更</目标>

    <步骤 名称="3.1 暂存变更" 优先级="关键">
      <描述>将所有变更添加到暂存区</描述>
      <命令>git add .</命令>
    </步骤>

    <步骤 名称="3.2 生成提交信息" 优先级="关键">
      <描述>根据分析结果生成中文提交信息</描述>
      <格式>
        [类型]: [简短描述]

        [可选：详细说明]
      </格式>
      <示例>
        feat: 新增用户登录功能
        fix: 修复表单验证错误
        docs: 更新 README 安装说明
      </示例>
    </步骤>

    <步骤 名称="3.3 执行提交" 优先级="关键">
      <描述>使用 HEREDOC 格式提交代码</描述>
      <命令格式>
        git commit -m "$(cat <<'EOF'
        [提交信息]
        EOF
        )"
      </命令格式>
    </步骤>
  </阶段>

  <阶段 序号="4" 名称="推送代码">
    <目标>将提交推送到远程仓库</目标>

    <步骤 名称="4.1 推送到远程" 优先级="关键">
      <描述>推送当前分支到远程仓库</描述>
      <命令>git push origin $(git branch --show-current)</命令>
    </步骤>

    <步骤 名称="4.2 处理新分支" 优先级="中">
      <描述>如果是新分支，设置上游跟踪</描述>
      <命令>git push -u origin $(git branch --show-current)</命令>
    </步骤>
  </阶段>

  <阶段 序号="5" 名称="结果报告">
    <目标>向用户展示操作结果</目标>

    <输出格式>
      ## ✅ 提交推送完成

      | 项目 | 内容 |
      |------|------|
      | **分支** | [分支名] |
      | **提交信息** | [提交信息] |
      | **变更文件** | [文件数量] 个文件 |
      | **提交 Hash** | [短 hash] |

      远程仓库已更新。
    </输出格式>
  </阶段>
</工作流程>

<错误处理>
  <场景 名称="没有变更">
    提示用户当前没有需要提交的变更，无需操作。
  </场景>

  <场景 名称="推送被拒绝">
    1. 检查是否是因为远程有新提交
    2. 建议用户先 git pull --rebase
    3. 绝不自动执行 force push
  </场景>

  <场景 名称="发现敏感文件">
    1. 列出发现的敏感文件
    2. 警告用户这些文件不应该被提交
    3. 建议添加到 .gitignore
    4. 询问是否继续（排除敏感文件）
  </场景>

  <场景 名称="提交失败">
    1. 检查 pre-commit hook 是否有错误
    2. 显示具体错误信息
    3. 提供修复建议
  </场景>
</错误处理>

<成功标准>
  - 所有变更已正确暂存
  - 提交信息符合 conventional commit 格式且为中文
  - 提交信息不含 emoji 和 AI 署名
  - 代码已成功推送到远程仓库
  - 向用户展示了清晰的操作结果
</成功标准>
