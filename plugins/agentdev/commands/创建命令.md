---
description: 交互式创建 Claude Code 斜杠命令 - 自动生成符合规范的命令文件并注册到插件
allowed-tools: Read, Write, Edit, Glob, Bash, TodoWrite, AskUserQuestion
---

<任务定义>
  你是一位 Claude Code 插件开发专家。你的职责是帮助用户快速创建符合规范的斜杠命令，包括：
  1. 收集命令需求信息
  2. 生成规范的命令文件（中文 XML 标签）
  3. 自动注册到 plugin.json
</任务定义>

<用户请求>
  $ARGUMENTS
</用户请求>

<关键约束>
  <命名规范>
    - 命令文件名必须使用中文（如 `数据分析.md`）
    - description 必须使用中文描述
    - XML 标签必须使用中文（如 `<任务定义>`、`<工作流程>`）
    - XML 属性必须使用中文（如 `序号`、`名称`、`优先级`）
  </命名规范>

  <输出规则>
    - 创建命令文件到 `commands/` 目录
    - 自动更新 plugin.json 的 commands 数组
    - 返回创建结果和使用说明
  </输出规则>
</关键约束>

<工作流程>
  <阶段 序号="1" 名称="需求收集">
    <目标>明确命令的功能和配置</目标>

    <步骤 名称="1.1 解析用户输入" 优先级="高">
      <描述>从 $ARGUMENTS 中提取命令信息</描述>
      <提取内容>
        - 命令名称（中文）
        - 命令功能描述
        - 预期工作流程
      </提取内容>
    </步骤>

    <步骤 名称="1.2 补充缺失信息" 优先级="中">
      <描述>如果信息不完整，使用 AskUserQuestion 向用户询问</描述>
      <询问内容>
        - 命令需要哪些工具？（Read/Write/Bash/Glob/Grep 等）
        - 命令的工作流程有几个阶段？
        - 是否需要用户参数？
        - 成功标准是什么？
      </询问内容>
    </步骤>
  </阶段>

  <阶段 序号="2" 名称="智能插件分类">
    <目标>分析命令类别，智能匹配到正确的插件</目标>

    <步骤 名称="2.1 扫描现有插件" 优先级="高">
      <描述>使用 Glob 查找所有 plugin.json，读取每个插件的职责</描述>
      <命令>
        - 使用 Glob 查找 `plugins/*/plugin.json`
        - 读取每个插件的 name、description、keywords
        - 构建插件职责映射表
      </命令>
      <输出>
        插件职责映射表示例：
        | 插件名 | 职责领域 | 关键词 |
        |--------|----------|--------|
        | frontend | 前端开发 | React, UI, 组件 |
        | bun | 后端开发 | API, 服务端, Bun |
        | coding | 需求分析 | Issue, 需求, 项目管理 |
        | agentdev | Agent/命令开发 | agent, command, 插件开发 |
        | code-analysis | 代码分析 | 调试, 分析, 搜索 |
        | orchestration | 多模型协调 | 并行, 验证, 工作流 |
      </输出>
    </步骤>

    <步骤 名称="2.2 分析命令类别" 优先级="关键">
      <描述>根据命令名称和描述，分析其所属类别</描述>
      <分析维度>
        - 命令的核心功能是什么？
        - 命令操作的对象是什么？（代码、文档、API、UI、Issue 等）
        - 命令的使用场景是什么？
        - 命令需要哪些工具？（这能暗示其类别）
      </分析维度>
      <分类规则>
        - 涉及 Agent/Command 创建 → agentdev
        - 涉及前端/UI/组件 → frontend
        - 涉及后端/API/服务 → bun
        - 涉及需求/Issue/项目管理 → coding
        - 涉及代码分析/调试/搜索 → code-analysis
        - 涉及多模型/并行执行/工作流 → orchestration
        - 无法匹配 → 询问用户或建议创建新插件
      </分类规则>
    </步骤>

    <步骤 名称="2.3 智能匹配" 优先级="关键">
      <描述>将命令类别与现有插件进行匹配</描述>
      <匹配逻辑>
        1. 精确匹配：命令类别完全符合某插件职责
        2. 模糊匹配：命令类别与某插件有较高相关性
        3. 无匹配：没有合适的现有插件
      </匹配逻辑>
      <输出示例>
        分析结果：
        - 命令名称：「创建命令」
        - 命令类别：插件开发工具
        - 推荐插件：agentdev（专注于 Agent 和 Command 开发）
        - 匹配度：精确匹配 ✓
      </输出示例>
    </步骤>

    <步骤 名称="2.4 用户确认" 优先级="高">
      <描述>向用户展示分析结果并请求确认</描述>
      <确认内容>
        - 展示分析得出的推荐插件
        - 说明推荐理由
        - 提供其他选项（其他插件列表、创建新插件）
        - 使用 AskUserQuestion 让用户确认或选择
      </确认内容>
    </步骤>

    <步骤 名称="2.5 处理无匹配情况" 优先级="中">
      <描述>当没有合适的现有插件时的处理</描述>
      <处理方案>
        - 询问用户是否创建新插件
        - 如果是，引导用户提供插件名称和描述
        - 创建新插件的基础结构（plugin.json、commands/）
        - 然后在新插件中创建命令
      </处理方案>
    </步骤>

    <步骤 名称="2.6 验证插件结构" 优先级="中">
      <描述>确保目标插件有 commands/ 目录</描述>
      <验证项>
        - plugin.json 存在且格式正确
        - commands/ 目录存在（不存在则创建）
      </验证项>
    </步骤>
  </阶段>

  <阶段 序号="3" 名称="生成命令文件">
    <目标>创建符合规范的命令 Markdown 文件</目标>

    <步骤 名称="3.1 构建文件内容" 优先级="关键">
      <描述>根据收集的信息生成命令文件</描述>

      <文件模板>
        ---
        description: [中文描述]
        allowed-tools: [工具列表]
        ---

        <任务定义>
          [AI 角色和核心职责]
        </任务定义>

        <用户请求>
          $ARGUMENTS
        </用户请求>

        <关键约束>
          <输出规则>
            - [规则列表]
          </输出规则>
        </关键约束>

        <工作流程>
          <阶段 序号="1" 名称="[阶段名]">
            <目标>[阶段目标]</目标>
            <步骤 名称="[步骤名]" 优先级="[优先级]">
              <描述>[步骤描述]</描述>
            </步骤>
          </阶段>
        </工作流程>

        <错误处理>
          <场景 名称="[错误场景]">
            [处理方法]
          </场景>
        </错误处理>

        <成功标准>
          - [标准列表]
        </成功标准>
      </文件模板>
    </步骤>

    <步骤 名称="3.2 写入文件" 优先级="关键">
      <描述>将生成的内容写入命令文件</描述>
      <路径格式>[插件目录]/commands/[命令名].md</路径格式>
    </步骤>
  </阶段>

  <阶段 序号="4" 名称="注册命令">
    <目标>将新命令添加到 plugin.json</目标>

    <步骤 名称="4.1 读取 plugin.json" 优先级="高">
      <描述>读取当前的 plugin.json 内容</描述>
    </步骤>

    <步骤 名称="4.2 添加命令路径" 优先级="关键">
      <描述>在 commands 数组中添加新命令的相对路径</描述>
      <格式>./commands/[命令名].md</格式>
    </步骤>

    <步骤 名称="4.3 保存更新" 优先级="关键">
      <描述>保存更新后的 plugin.json</描述>
    </步骤>
  </阶段>

  <阶段 序号="5" 名称="返回结果">
    <目标>向用户展示创建结果和使用说明</目标>

    <输出格式>
      ## ✅ 命令创建成功

      | 项目 | 内容 |
      |------|------|
      | **命令名称** | /[插件名]:[命令名] |
      | **命令文件** | [文件路径] |
      | **描述** | [命令描述] |

      ### 使用方式

      ```bash
      /[插件名]:[命令名] [参数说明]
      ```

      ### 下一步

      - 可以根据需要编辑命令文件，添加更多细节
      - 运行 `/[插件名]:帮助` 查看所有可用命令
    </输出格式>
  </阶段>

  <阶段 序号="6" 名称="可选：发布到插件市场">
    <目标>询问用户是否发布，如果是则执行完整发布流程</目标>

    <步骤 名称="6.1 询问是否发布" 优先级="高">
      <描述>使用 AskUserQuestion 询问用户是否要发布到插件市场</描述>
      <选项>
        - 是，立即发布
        - 否，稍后手动发布（可用 /agentdev:发布）
      </选项>
    </步骤>

    <步骤 名称="6.2 更新插件版本号" 优先级="关键" 条件="用户选择发布">
      <描述>更新 plugin.json 中的 version 字段</描述>
      <版本规则>
        - 新增命令属于新功能 → 次版本号 +1（如 1.1.0 → 1.2.0）
        - 修复命令属于修复 → 修订版本号 +1（如 1.1.0 → 1.1.1）
      </版本规则>
      <命令>
        1. 读取当前版本号
        2. 计算新版本号
        3. 更新 plugin.json
      </命令>
    </步骤>

    <步骤 名称="6.3 更新 marketplace.json" 优先级="关键" 条件="用户选择发布">
      <描述>同步更新 .claude-plugin/marketplace.json 中对应插件的版本号</描述>
      <路径>.claude-plugin/marketplace.json</路径>
      <注意>版本号必须与 plugin.json 保持一致</注意>
    </步骤>

    <步骤 名称="6.4 提交更改" 优先级="高" 条件="用户选择发布">
      <描述>使用 git 提交所有更改</描述>
      <提交格式>
        feat([插件名]): 新增 [命令名] 命令

        - [命令描述]
        - [其他变更说明]
      </提交格式>
    </步骤>

    <步骤 名称="6.5 创建 Git Tag" 优先级="关键" 条件="用户选择发布">
      <描述>创建版本标签</描述>
      <标签格式>plugins/[插件名]/v[版本号]</标签格式>
      <命令>git tag -a plugins/[插件名]/v[版本号] -m "[发布说明]"</命令>
    </步骤>

    <步骤 名称="6.6 推送到远程" 优先级="高" 条件="用户选择发布">
      <描述>推送代码和标签到 GitHub</描述>
      <命令>git push origin main --tags</命令>
    </步骤>

    <步骤 名称="6.7 返回发布结果" 优先级="中" 条件="用户选择发布">
      <输出格式>
        ## 🚀 发布完成

        | 项目 | 内容 |
        |------|------|
        | **插件** | [插件名] |
        | **版本** | v[版本号] |
        | **Git Tag** | plugins/[插件名]/v[版本号] |

        用户可以通过 `claudeup update` 获取更新。
      </输出格式>
    </步骤>
  </阶段>
</工作流程>

<错误处理>
  <场景 名称="找不到插件目录">
    1. 使用 Glob 搜索 plugin.json
    2. 如果找不到，提示用户需要先创建插件
    3. 引导用户到正确的目录
  </场景>

  <场景 名称="命令已存在">
    1. 检查同名命令是否已存在
    2. 如果存在，询问用户是否覆盖
    3. 提供重命名建议
  </场景>

  <场景 名称="plugin.json 格式错误">
    1. 尝试解析 JSON
    2. 如果失败，报告具体错误位置
    3. 提供修复建议
  </场景>

  <场景 名称="用户输入不完整">
    1. 使用 AskUserQuestion 收集缺失信息
    2. 提供合理的默认值建议
    3. 确认后继续创建
  </场景>
</错误处理>

<示例>
  <示例 名称="智能分类 - 前端命令">
    <输入>/agentdev:创建命令 组件文档 - 自动生成 React 组件的使用文档</输入>
    <执行过程>
      1. 解析：命令名 = "组件文档"，描述 = "自动生成 React 组件的使用文档"
      2. 扫描插件：找到 6 个插件（frontend, bun, coding, agentdev, code-analysis, orchestration）
      3. 分析类别：
         - 核心功能：生成文档
         - 操作对象：React 组件
         - 使用场景：前端开发
      4. 智能匹配：
         - 推荐插件：frontend（专注于前端开发）
         - 匹配度：精确匹配 ✓
         - 理由：涉及 React 组件，属于前端开发领域
      5. 用户确认：确认放入 frontend 插件
      6. 创建：plugins/frontend/commands/组件文档.md
      7. 注册：更新 frontend/plugin.json
      8. 返回：/frontend:组件文档 使用说明
    </执行过程>
  </示例>

  <示例 名称="智能分类 - 后端命令">
    <输入>/agentdev:创建命令 API健康检查 - 检查所有 API 端点的可用性和响应时间</输入>
    <执行过程>
      1. 解析：命令名 = "API健康检查"
      2. 扫描插件：找到 6 个插件
      3. 分析类别：
         - 核心功能：健康检查
         - 操作对象：API 端点
         - 使用场景：后端运维
      4. 智能匹配：
         - 推荐插件：bun（专注于后端开发）
         - 匹配度：精确匹配 ✓
      5. 用户确认 → 创建 → 注册 → 返回
    </执行过程>
  </示例>

  <示例 名称="智能分类 - 无匹配情况">
    <输入>/agentdev:创建命令 数据库迁移 - 管理数据库 schema 变更和迁移</输入>
    <执行过程>
      1. 解析：命令名 = "数据库迁移"
      2. 扫描插件：找到 6 个插件
      3. 分析类别：
         - 核心功能：数据库管理
         - 操作对象：数据库 schema
         - 使用场景：DevOps / 数据库管理
      4. 智能匹配：
         - 最相近插件：bun（有后端相关性，但不完全匹配）
         - 匹配度：模糊匹配 △
      5. 用户选择：
         - 选项 A：放入 bun 插件（推荐）
         - 选项 B：创建新插件 "database"
         - 选项 C：手动选择其他插件
      6. 用户选择 A → 创建 → 注册 → 返回
    </执行过程>
  </示例>

  <示例 名称="创建新插件">
    <输入>/agentdev:创建命令 监控告警 - 配置和管理系统监控告警规则</输入>
    <执行过程>
      1. 解析：命令名 = "监控告警"
      2. 扫描插件：找到 6 个插件
      3. 分析类别：监控/运维领域，无匹配插件
      4. 用户选择：创建新插件
      5. 收集新插件信息：
         - 插件名：monitoring
         - 描述：系统监控和告警管理
      6. 创建插件结构：
         - plugins/monitoring/plugin.json
         - plugins/monitoring/commands/
      7. 创建命令：plugins/monitoring/commands/监控告警.md
      8. 返回：/monitoring:监控告警 使用说明
    </执行过程>
  </示例>
</示例>

<成功标准>
  - 已扫描所有现有插件并构建职责映射表
  - 已分析命令类别并给出合理的插件推荐
  - 用户确认或选择了目标插件
  - 命令文件已创建并符合中文 XML 标签规范
  - plugin.json 已更新包含新命令
  - 返回了完整的使用说明
  - 命令可以通过 /[插件名]:[命令名] 调用
  - （可选发布）plugin.json 版本号已更新
  - （可选发布）marketplace.json 版本号已同步
  - （可选发布）Git Tag 已创建并推送
</成功标准>
