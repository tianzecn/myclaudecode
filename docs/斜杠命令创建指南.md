# Claude Code 斜杠命令（Slash Commands）创建指南

> 本指南详细介绍如何在 Claude Code 插件中创建自定义斜杠命令。

---

## 目录

1. [什么是斜杠命令](#什么是斜杠命令)
2. [文件结构](#文件结构)
3. [命令文件格式](#命令文件格式)
4. [YAML Frontmatter 详解](#yaml-frontmatter-详解)
5. [命令内容编写](#命令内容编写)
6. [变量与参数](#变量与参数)
7. [XML 标签结构](#xml-标签结构)
8. [完整示例](#完整示例)
9. [最佳实践](#最佳实践)
10. [常见问题](#常见问题)

---

## 什么是斜杠命令

斜杠命令是 Claude Code 插件中用户可直接调用的快捷命令。用户在对话中输入 `/plugin-name:command-name` 即可触发相应功能。

**示例：**
```bash
/coding:需求分析 添加用户认证功能
/coding:开发归档 42
/frontend:implement 实现登录页面
```

**特点：**
- 🚀 一键触发复杂工作流
- 📝 支持用户参数传入
- 🔧 可指定允许使用的工具
- 🎯 可引用插件中的 Skills

---

## 文件结构

### 插件目录结构

```
plugins/
└── your-plugin/
    ├── plugin.json          # 插件清单（必须）
    ├── commands/            # 命令目录
    │   ├── 需求分析.md       # 命令文件（使用中文命名）
    │   └── 帮助.md          # 帮助命令（推荐）
    ├── agents/              # 代理目录（可选）
    ├── skills/              # 技能目录（可选）
    └── README.md            # 插件说明（推荐）
```

### plugin.json 中声明命令

```json
{
  "name": "your-plugin",
  "version": "1.0.0",
  "description": "插件描述（使用中文）",
  "author": {
    "name": "your-name",
    "email": "",
    "company": ""
  },
  "license": "MIT",
  "keywords": ["keyword1", "keyword2"],
  "commands": [
    "./commands/需求分析.md",
    "./commands/帮助.md"
  ]
}
```

**注意：**
- `commands` 数组中的路径是相对于插件根目录的
- 使用 `./` 前缀表示相对路径
- 命令文件必须是 `.md` 格式
- **命令文件名必须使用中文**（如 `需求分析.md`、`开发归档.md`）

---

## 命令文件格式

每个命令文件由两部分组成：

1. **YAML Frontmatter** - 元数据（用 `---` 包裹）
2. **Markdown 内容** - 命令的实际指令

### 基本结构

```markdown
---
description: 命令的中文描述
allowed-tools: Tool1, Tool2, Tool3
---

# 命令标题

[命令的具体指令和工作流程]
```

---

## YAML Frontmatter 详解

### 必需字段

| 字段 | 类型 | 说明 |
|------|------|------|
| `description` | string | 命令描述（**必须使用中文**） |

### 可选字段

| 字段 | 类型 | 说明 |
|------|------|------|
| `allowed-tools` | string | 允许使用的工具列表，逗号分隔 |
| `skills` | string | 引用的技能列表，逗号分隔 |
| `model` | string | 指定模型（sonnet/opus/haiku） |

### 示例

```yaml
---
description: AI 驱动的需求分析与 GitHub Issue 自动创建
allowed-tools: Read, Glob, Grep, Bash, TodoWrite, AskUserQuestion
skills: orchestration:multi-agent-coordination
model: sonnet
---
```

### 常用工具列表

| 工具名 | 用途 |
|--------|------|
| `Read` | 读取文件内容 |
| `Write` | 写入文件 |
| `Edit` | 编辑文件 |
| `Glob` | 文件模式匹配 |
| `Grep` | 内容搜索 |
| `Bash` | 执行 shell 命令 |
| `TodoWrite` | 任务追踪 |
| `AskUserQuestion` | 向用户提问 |
| `Task` | 启动子代理 |
| `WebFetch` | 获取网页内容 |
| `WebSearch` | 网络搜索 |

---

## 命令内容编写

### 推荐结构

```markdown
---
description: 命令描述
allowed-tools: Read, Bash
---

<任务定义>
  定义 AI 的角色和核心职责
</任务定义>

<用户请求>
  $ARGUMENTS
</用户请求>

<关键约束>
  <输出规则>
    - 输出规则 1
    - 输出规则 2
  </输出规则>
</关键约束>

<工作流程>
  <阶段 序号="1" 名称="阶段名称">
    <目标>阶段目标</目标>
    <步骤 名称="步骤名称">
      <描述>步骤描述</描述>
    </步骤>
  </阶段>
</工作流程>

<错误处理>
  <场景 名称="错误场景">
    处理方法
  </场景>
</错误处理>

<成功标准>
  - 成功标准 1
  - 成功标准 2
</成功标准>
```

---

## 变量与参数

### $ARGUMENTS 变量

`$ARGUMENTS` 是用户在命令后输入的所有参数。

**用户输入：**
```bash
/coding:需求分析 添加用户登录功能，支持 OAuth2
```

**$ARGUMENTS 值：**
```
添加用户登录功能，支持 OAuth2
```

### 使用方式

```markdown
<用户请求>
  $ARGUMENTS
</用户请求>
```

或在文本中直接引用：

```markdown
分析用户需求：$ARGUMENTS
```

### 数字参数示例

```bash
/coding:开发归档 42
```

在命令中：

```markdown
<用户请求>
  Issue 编号：#$ARGUMENTS
</用户请求>
```

---

## XML 标签结构

Claude Code 推荐使用中文 XML 标签来结构化命令内容，这符合本项目的规范要求。

### 常用标签

| 标签 | 用途 |
|------|------|
| `<任务定义>` | 定义 AI 角色和核心职责 |
| `<用户请求>` | 包裹用户输入 |
| `<关键约束>` | 关键约束条件 |
| `<工作流程>` | 工作流程定义 |
| `<阶段>` | 工作阶段 |
| `<步骤>` | 具体步骤 |
| `<错误处理>` | 错误处理 |
| `<示例>` | 使用示例 |
| `<成功标准>` | 成功标准 |

### 常用属性

| 属性 | 用途 |
|------|------|
| `序号` | 阶段或步骤的编号 |
| `名称` | 阶段或步骤的名称 |
| `优先级` | 步骤的优先级（关键/高/中/低） |

### 嵌套示例

```xml
<工作流程>
  <阶段 序号="1" 名称="分析阶段">
    <目标>理解用户需求</目标>

    <步骤 名称="1.1 读取文档" 优先级="高">
      <描述>读取项目文档</描述>
      <文件列表>
        - README.md
        - package.json
      </文件列表>
      <提取内容>
        - 项目介绍
        - 技术栈
      </提取内容>
    </步骤>

    <步骤 名称="1.2 分析代码" 优先级="中">
      <描述>分析核心代码</描述>
    </步骤>
  </阶段>

  <阶段 序号="2" 名称="执行阶段">
    <目标>执行具体操作</目标>
    <!-- 更多步骤 -->
  </阶段>
</工作流程>
```

---

## 完整示例

### 示例 1：简单命令（帮助命令）

```markdown
---
description: 显示插件的完整帮助信息 - 命令列表、功能说明和使用示例
allowed-tools: Read
---

<任务定义>
  你是插件的帮助助手。你的职责是向用户展示插件的完整帮助信息。
</任务定义>

<帮助内容>
  向用户展示以下帮助信息：

  ## 插件 v1.0.0

  **插件简介**

  ## 可用命令

  | 命令 | 说明 |
  |------|------|
  | **/plugin:命令1** | 命令1描述 |
  | **/plugin:帮助** | 显示帮助 |

  ## 使用示例

  ### 示例 1

  \`\`\`bash
  /plugin:命令1 参数
  \`\`\`

  **结果**: 描述结果
</帮助内容>

<输出规则>
  - 直接展示帮助信息
  - 使用 Markdown 格式化输出
</输出规则>
```

### 示例 2：复杂工作流命令

```markdown
---
description: AI 驱动的需求分析与 GitHub Issue 自动创建
allowed-tools: Read, Glob, Grep, Bash, TodoWrite, AskUserQuestion
---

<任务定义>
  你是一位顶级 AI 需求分析专家。你的核心职责是：
  1. 深度分析项目代码库
  2. 生成结构化的 GitHub Issue
  3. 提供技术建议
</任务定义>

<用户请求>
  $ARGUMENTS
</用户请求>

<关键约束>
  <输出规则>
    - 不要输出中间分析报告
    - 最终目标是创建 GitHub Issue 并返回链接
    - 所有输出必须使用中文
  </输出规则>
</关键约束>

<工作流程>
  <阶段 序号="1" 名称="项目分析">
    <目标>全面分析项目结构和技术栈</目标>

    <步骤 名称="1.1 读取文档" 优先级="高">
      <文件列表>
        - README.md
        - package.json
        - docs/
      </文件列表>
    </步骤>
  </阶段>

  <阶段 序号="2" 名称="生成 Issue">
    <目标>创建结构化的 GitHub Issue</目标>

    <步骤 名称="2.1 构建内容" 优先级="高">
      <Issue结构>
        <标题>简洁标题（50字符内）</标题>
        <问题描述>问题描述</问题描述>
        <预期目标>预期目标</预期目标>
        <技术方案>技术方案</技术方案>
        <验收标准>验收标准</验收标准>
      </Issue结构>
    </步骤>

    <步骤 名称="2.2 提交 Issue" 优先级="关键">
      <命令>gh issue create --title "标题" --body "内容"</命令>
    </步骤>
  </阶段>
</工作流程>

<错误处理>
  <场景 名称="gh CLI 未安装">
    1. 检查: `which gh`
    2. 引导安装: `brew install gh`
    3. 引导认证: `gh auth login`
  </场景>
</错误处理>

<成功标准>
  - Issue 创建成功
  - 返回 Issue 链接
</成功标准>
```

---

## 最佳实践

### 1. 命令文件名使用中文

✅ 正确：
```
commands/
├── 需求分析.md
├── 开发归档.md
└── 帮助.md
```

❌ 错误：
```
commands/
├── requirement.md
├── done.md
└── help.md
```

### 2. 描述使用中文

✅ 正确：
```yaml
description: AI 驱动的需求分析与 GitHub Issue 自动创建
```

❌ 错误：
```yaml
description: AI-powered requirement analysis and GitHub Issue creation
```

### 3. XML 标签使用中文

✅ 正确：
```xml
<任务定义>
  你是一位需求分析专家
</任务定义>

<工作流程>
  <阶段 序号="1" 名称="分析">
    <步骤 名称="读取文档" 优先级="高">
      ...
    </步骤>
  </阶段>
</工作流程>
```

❌ 错误：
```xml
<mission>
  You are a requirement analyst
</mission>

<workflow>
  <phase number="1" name="Analysis">
    <step name="Read docs" priority="high">
      ...
    </step>
  </phase>
</workflow>
```

### 4. 工具权限最小化

只声明命令实际需要的工具：

✅ 正确：
```yaml
allowed-tools: Read, Bash, TodoWrite
```

❌ 过度授权：
```yaml
allowed-tools: Read, Write, Edit, Bash, Glob, Grep, Task, WebFetch, WebSearch, TodoWrite
```

### 5. 使用 TodoWrite 追踪进度

在复杂工作流中，使用 `TodoWrite` 工具让用户了解进度：

```markdown
<工作流程>
  <阶段 序号="1">
    <步骤>
      在开始时使用 TodoWrite 创建任务列表
    </步骤>
  </阶段>
</工作流程>
```

### 6. 提供错误处理

```markdown
<错误处理>
  <场景 名称="文件未找到">
    1. 检查路径是否正确
    2. 使用 Glob 搜索可能的位置
    3. 询问用户确认
  </场景>

  <场景 名称="权限不足">
    1. 提示用户检查权限
    2. 提供手动执行的命令
  </场景>
</错误处理>
```

### 7. 包含使用示例

```markdown
<示例>
  <示例 名称="功能请求">
    <输入>/coding:需求分析 添加用户认证</输入>
    <执行过程>
      1. 分析项目结构
      2. 检测现有认证模式
      3. 生成 Issue
    </执行过程>
  </示例>
</示例>
```

### 8. 创建帮助命令

每个插件都应该有 `帮助.md` 命令，列出所有可用命令和使用说明。

---

## 常见问题

### Q1: 命令没有出现在可用列表中？

**检查：**
1. `plugin.json` 中是否正确声明了命令路径
2. 命令文件路径是否正确（使用 `./` 前缀）
3. YAML frontmatter 格式是否正确（`---` 包裹）

### Q2: $ARGUMENTS 没有被替换？

**检查：**
1. 确保使用 `$ARGUMENTS`（大写，带 $ 符号）
2. 用户调用时是否提供了参数

### Q3: 工具调用被拒绝？

**检查：**
1. `allowed-tools` 中是否包含该工具
2. 工具名称拼写是否正确（区分大小写）

### Q4: 如何引用插件中的 Skill？

```yaml
---
description: 命令描述
skills: plugin-name:skill-name, orchestration:multi-agent-coordination
---
```

### Q5: 如何让命令使用特定模型？

```yaml
---
description: 命令描述
model: opus
---
```

可选值：`sonnet`（默认）、`opus`、`haiku`

---

## 相关资源

- [Claude Code 官方文档](https://docs.anthropic.com/claude-code)
- [Anthropic XML 最佳实践](https://docs.anthropic.com/claude/docs/use-xml-tags)
- [Conventional Commits 规范](https://www.conventionalcommits.org/)

---

## 更新日志

| 日期 | 版本 | 变更 |
|------|------|------|
| 2025-12-25 | 1.1.0 | 更新为中文 XML 标签规范 |
| 2025-12-25 | 1.0.0 | 初始版本 |

---

**维护者**: tianzecn
**仓库**: https://github.com/tianzecn/myclaudecode
